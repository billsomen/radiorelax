{% extends "MainBundle::base.html.twig" %}

{% block title %}
  {{ artist.name }} | {{ album.name }}
{% endblock title %} 

{% block body_inner_main %}
  <!--Top Artist Section-->
  <div class="ms_top_artist">
    <div class="container-fluid">
      <div class="album_single_data">
        <div class="album_single_img">
          <img src="{{ album.profile | cloudinary_img('show') }}" alt="" class="img-fluid">
        </div>
        <div class="album_single_text">
          <h2>{{ album|album_duration }} - {{ album.name }} | {{ album.dateRelease|date("Y") }}</h2>
          <p class="singer_name"><a href="{{ path('core_artists_show', {'namespace': artist.namespace}) }}">{{ artist.name }}</a></p>
          <div class="about_artist">
            <p>{#About: #}{{ album.desc }}</p>
            {# <p>
               {{ album.dateRelease|date("Y") }}
             </p>#}
            {#<p>
              {{ "label.duration"|trans }}: <b>{{ album|album_duration }}</b>
            </p>#}
          </div>
          <div class="album_btn">
            {% if app.user %}
              {% if app.user.profiles.listener.hasAlbumId(album.id) %}
                {#<a href="#" class="ms_btn" title="Dans ma playlist">
                  <span class="fa fa-eye"></span>
                  Panier | {{ album.account.amount | amount_format }}
                </a>#}
                <a href="{{ path('admin_profile_playlist') }}" class="ms_btn" title="Dans ma playlist">
                  <span class="fa fa-home"></span>
                  {{ 'menu.admin.playlist'|trans }}
                </a>
              {% else %}
                <a href="{{ path('xs_market_place_cart_add_album', {'id': album.id}) }}" class="ms_btn" title="{{ "button.add_to_cart"|trans }}">
                  <span class="fa fa-cart-plus"></span>
                  {{ 'menu.cart.tite'|trans }} | {{ album.account.amount | amount_format }}
                </a>
              {% endif %}
              {#<a href="#" class="ms_btn" title="Dans le panier">
                <span class="fa fa-check"></span>
                Panier
              </a>#}
              {#<a href="#" class="ms_btn">
                <span class="fa fa-check"></span>
                Acheter
              </a>#}
              {% if app.user.profiles.listener.hasFavoriteAlbumId(album.id) %}
                <a href="{{ path('admin_profile_favorites_remove_album', {'id': album.id}) }}" class="ms_btn" title="Retirer des favoris">
                  <span class="fa fa-heart"></span>
                  Favorites
                </a>
              {% else %}
                <a href="{{ path('admin_profile_favorites_add_album', {'id': album.id}) }}" class="ms_btn ms_btn_white" title="Ajouter aux favoris">
                  <span class="fa fa-heart-o"></span>
                  Favorites
                </a>
              {% endif %}
            {% else %}
              <a href="{{ path('login', {'_locale': 'fr'}) }}" class="ms_btn ms_btn_white" title="{{ 'xs_user.login.hint'|trans }}">
                <span class="fa fa-sign-in"></span>
                {{ 'xs_user.login.hint'|trans }}
              </a>
            {% endif %}
          </div>
        </div>
      </div>
      <!----Song List---->
      <div class="ms_weekly_wrapper">
        <div class="ms_weekly_inner">
          <div class="row">
            <div class="col-lg-12">
              <div class="ms_heading">
                <h1>All {{ album.musics|length }} of {{ album.name }} | {{ album.dateRelease|date("Y") }}</h1>
              </div>
            </div>
            <div class="col-lg-4 col-md-12 padding_right40">
              {% for music in album.musics %}
                <div class="ms_weekly_box ms_active_play" id="music-box-{{ loop.index0 }}">
                  <div class="weekly_left">
                                    <span class="w_top_no">
										{{ loop.index |album_list_number_format}}
									</span>
                    <div class="w_top_song">
                      <div class="w_tp_song_img">
                        <img src="{{ album.profile | cloudinary_img }}" alt="">
                        <div class="ms_song_overlay">
                        </div>
                        <a class="ms_play_icon visible" onclick="updatePlaying(event, {{ loop.index0 }})">
                          <img src="{{ asset('assets/corebundle/images/svg/play.svg') }}" alt="">
                        </a>
                        {#<div class="ms_play_icon invisible" id="play-bar-{{ loop.index0 }}">
                          <div class="ms_bars">
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                            <div class="bar"></div>
                          </div>
                        </div>#}
                      </div>
                      <div class="w_tp_song_name">
                        <h3><a href="#">{{ music.name }}</a></h3>
                        <p><a href="{{ path('core_artists_show', {'namespace': artist.namespace}) }}">{{ artist.name }}</a></p>
                      </div>
                    </div>
                  </div>
                  <div class="weekly_right">
                    <span class="w_song_time">{{ music.duration|duration_format }}</span>
                    <span class="ms_more_icon" data-other="1">
										<img src="{{ asset('assets/corebundle/images/svg/more1.svg') }}" alt="">
									</span>
                  </div>
                  <ul class="more_option">
                    <li>
                      {% if app.user %}
                      {% if app.user.profiles.listener.hasFavoriteMusicId(music.id) %}
                        <a href="{{ path('admin_profile_favorites_remove_music', {'id': music.id}) }}" title="Retirer des favoris">
                          <span class="fa fa-heart"></span>
                          Retirer
                        </a>
                      {% else %}
                        <a href="{{ path('admin_profile_favorites_add_music', {'id': music.id,}) }}" title="Ajouter aux favoris">
                          <span class="fa fa-heart-o"></span>
                          J'aime
                        </a>
                      {% endif %}
                      {% else %}
                        <a href="{{ path('login', {'_locale': 'fr'}) }}" class="ms_btn ms_btn_white" title="Se connecter">
                          <span class="fa fa-sign-in"></span>
                          Se connecter
                        </a>
                      {% endif %}
                    </li>
                    {#                    <li><a href="#"><span class="opt_icon"><span class="icon icon_queue"></span></span>Add To Queue</a></li>#}
                    {#                    <li><a href="#"><span class="opt_icon"><span class="icon icon_dwn"></span></span>Download Now</a></li>#}
{#                    <li><a href="#"><span class="opt_icon"><span class="icon icon_playlst"></span></span>Soon: Acheter</a></li>#}
                    {#                    <li><a href="#"><span class="opt_icon"><span class="icon icon_playlst"></span></span>Add To Playlist</a></li>#}
                    {#                    <li><a href="#"><span class="opt_icon"><span class="icon icon_share"></span></span>Share</a></li>#}
                  </ul>
                </div>
                <div class="ms_divider"></div>
              {% endfor %}
            </div>
          </div>
        </div>
      </div>
    </div>
  </div>
{% endblock %}

{% block audio_player %}
  {#TODO:  Audio Player#}
  <!----Audio Player Section---->
  <div class="ms_player_wrapper">
    <div class="ms_player_close">
      <i class="fa fa-angle-up" aria-hidden="true"></i>
    </div>
    <div class="player_mid">
      <div class="audio-player">
        <div id="jquery_jplayer_1" class="jp-jplayer"></div>
        <div id="jp_container_1" class="jp-audio" role="application" aria-label="media player">
          <div class="player_left">
            <div class="ms_play_song">
              <div class="play_song_name">
                <a href="javascript:void(0);" id="playlist-text">
                  <div class="jp-now-playing flex-item">
                    <div class="jp-track-name"></div>
                    <div class="jp-artist-name"></div>
                  </div>
                </a>
              </div>
            </div>
            <div class="play_song_options">
              <ul>
                <li><a href="{{ asset('assets/corebundle/#"><span class="song_optn_icon') }}"><i class="ms_icon icon_fav"></i></span>Add To Favourites</a></li>
              </ul>
            </div>
            <span class="play-left-arrow"><i class="fa fa-angle-right" aria-hidden="true"></i></span>
          </div>
          <!----Right Queue---->
          <div class="jp_queue_wrapper">
            <span class="que_text" id="myPlaylistQueue"><i class="fa fa-angle-up" aria-hidden="true"></i> queue</span>
            <div id="playlist-wrap" class="jp-playlist">
              <div class="jp_queue_cls"><i class="fa fa-times" aria-hidden="true"></i></div>
              <h2>queue</h2>
              <div class="jp_queue_list_inner">
                <ul>
                  <li>&nbsp;</li>
                </ul>
              </div>
              <div class="jp_queue_btn">
                <a href="javascript:;" class="ms_clear" data-toggle="modal" data-target="#clear_modal">clear</a>
                <a href="" class="ms_save" data-toggle="modal" data-target="#save_modal">save</a>
              </div>
            </div>
          </div>
          <div class="jp-type-playlist">
            <div class="jp-gui jp-interface flex-wrap">
              <div class="jp-controls flex-item">
                <button class="jp-previous" tabindex="0">
                  <i class="ms_play_control"></i>
                </button>
                <button class="jp-play" tabindex="0">
                  <i class="ms_play_control"></i>
                </button>
                <button class="jp-next" tabindex="0">
                  <i class="ms_play_control"></i>
                </button>
              </div>
              <div class="jp-progress-container flex-item">
                <div class="jp-time-holder">
                  <span class="jp-current-time" role="timer" aria-label="time">&nbsp;</span>
                  <span class="jp-duration" role="timer" aria-label="duration">&nbsp;</span>
                </div>
                <div class="jp-progress">
                  <div class="jp-seek-bar">
                    <div class="jp-play-bar">
                      <div class="bullet">
                      </div>
                    </div>
                  </div>
                </div>
              </div>
              <div class="jp-volume-controls flex-item">
                <div class="widget knob-container">
                  <div class="knob-wrapper-outer">
                    <div class="knob-wrapper">
                      <div class="knob-mask">
                        <div class="knob d3"><span></span></div>
                        <div class="handle"></div>
                        <div class="round">
                          <img src="{{ asset('assets/corebundle/images/svg/volume.svg') }}" alt="">
                        </div>
                      </div>
                    </div>
                    <!-- <input></input> -->
                  </div>
                </div>
              </div>
              <div class="jp-toggles flex-item">
                <button class="jp-shuffle" tabindex="0" title="Shuffle">
                  <i class="ms_play_control"></i></button>
                <button class="jp-repeat" tabindex="0" title="Repeat"><i class="ms_play_control"></i></button>
              </div>
              <div class="jp_quality_optn custom_select">
                <select>
                  <option>quality</option>
                  <option value="3">medium</option>
                </select>
              </div>
            </div>
          </div>
        </div>
      </div>
    </div>
    <!--main div-->
  </div>
{% endblock %}

{% block player_js %}
  {% include "MainBundle:Core/_partials:audio-player.html.twig" %}
  {#We try to update the çurrent playing index #}
  <script>
    // document.read
    //On réçupère les musiques
    var datas = [
      //TODO: We use twig and data s from the server to define files to play
      {% for music in album.musics %}
      {
        image : '{{ album.profile | cloudinary_img }}',
        title: "{{ music.name | truncate(20) }}",
        artist: "{{ artist.name }}",
        mp3: "{{ music.src | cloudinary_file(music.duration) }}",
        oga: "{{ music.src | cloudinary_file }}",
        id: "{{ music.id }}"
      },
      {% endfor %}
    ];

    function updatePlaying(event, key) {
      event.preventDefault();
      // alert(4);
      var target = $(event.target).parent();
      (target).toggleClass("is_playing");
      
      let icon_path = "{{ asset('assets/corebundle/images/svg/') }}";
      let icon = "play";
      if(target.hasClass("is_playing")){
        icon = "pause";
        myPlaylist.play(key);
      }
      else{
        myPlaylist.pause();
      }

      target.html('<img src="'+icon_path+icon+'.svg" alt="">');
      
    }
  </script>
{% endblock %}