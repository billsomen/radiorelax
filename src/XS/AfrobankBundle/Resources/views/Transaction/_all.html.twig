{% if user_account.account %}
  <p>Mon Solde : <h3>{#<span class="badge badge-primary">#}{{ user_account.account.amount.currency }} {{ user_account.account.amount.value | number_format}}{#</span>#}</h3></p>
{% endif %}
<div class="help-block">
  <ul>
    <li><b><i class="fa fa-long-arrow-right"></i></b> : Transaction entrante (réception).</li>
    <li><b><i class="fa fa-long-arrow-left"></i></b> : Transaction sortante (envoi).</li>
  </ul>
  <label class="label" style="background: orange">Erreur</label>
  <label class="label" style="background: lightgreen">Terminé </label>
  <label class="label" style="background: whitesmoke; color: black">En cours</label>
</div>
<table class="table table-striped table-bordered table-hover data-table">
  <thead>
  <tr>
    <th>#</th>
    <th>Code</th>
    <th>Montant</th>
    <th>Moyen</th>
    <th>Raison</th>
    <th>Date</th>
  </tr>
  </thead>
  <tbody>
  {% if user_account %}
    {% for transaction in user_account.account.transactions | reverse %}
      {#Definition de la couleur actuelle :: color#}
      {% set color = 'whitesmoke; color: black' %}
      {% if transaction.state == 'finished' %}
        {% set color = 'lightgreen' %}
      {% elseif transaction.state == 'error' %}
        {% set color = 'orange' %}
      {% endif %}
      {% if transaction.sender.id == user_account.id %}
        <tr style="background: {{ color }}">
          <td>{{ loop.index }} <i class="fa fa-long-arrow-left"></i></td>
          <td>
            <a data-toggle="modal" class="btn blue" href="#transaction-{{ transaction.id }}"><i class='fa fa-exchange'></i> {{ transaction.code | upper  }}</a>
            {#Modal, Historique transactions.#}
            <div class="modal fade" id="transaction-{{ transaction.id }}" tabindex="-1" role="basic" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title"><i class='fa fa-exchange'></i> : {{ transaction.code | upper  }}</h4>
                  </div>
                  <div class="modal-body">
                    <div class='help-block'>
                      {% set nickname = 'Aucun' %}
                      {% if transaction.sender %}
                        {% set nickname = transaction.sender.nickname ~' | '~ transaction.sender.username %}
                      {% endif %}
                      <ul>
                        <li>{{ transaction.reason }}</li>
                        <li><i class='fa fa-user'></i> <a href='#'>{{ nickname }}</a> <i class='fa fa-long-arrow-right'></i> <a href='#'> {{ transaction.receiver.nickname ~' | '~ transaction.receiver.username }} </a></li>
                        <li><i class='fa fa-bank'></i> <a href='#'> {{ transaction.bank }} </a></li>
                        <li><i class='fa fa-money'></i> <b>Montant :</b> {{ transaction.amount.value|number_format ~' '~  transaction.amount.currency}}</li>
                        <li><i class='fa fa-money'></i> <b>Frais :</b> {{ transaction.fee|number_format ~' '~  transaction.amount.currency}}</li>
                        <li><span title='{{ transaction.dateAdd | time_diff }}' class="tooltips"><i class='fa fa-clock-o'></i> {{ transaction.dateAdd| date('Y-m-d | h:i')}}</span></li>
                        <li><label class='label' style='background: {{ color }}'>{{ transaction.state }}</label></li>
                      </ul>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn dark btn-outline" data-dismiss="modal">Fermer et Continuer</button>
                  </div>
                </div>
                <!-- /.modal-content -->
              </div>
              <!-- /.modal-dialog -->
            </div>
          </td>
          <td>{{ transaction.amount.value|number_format ~' '~  transaction.amount.currency}}</td>
          <td><a href="#">{{ transaction.bank }}</a> </td>
          <td>
            {% if transaction.course %}
              <a
                class="popovers"
                data-container="body"
                data-trigger="hover"
                data-placement="top"
                data-content="Prix : XAF {{ transaction.course.lifePrice | number_format }}"
                data-original-title="{{ transaction.course.name }}"
                href="{{ path('xs_manager_courses_show', {'id': transaction.course.id}) }}"
              >
                {{ transaction.reason }}
              </a>
              {#<a >{{ transaction.reason }}</a>#}
            {% else %}
              {{ transaction.reason }}
            {% endif %}
          </td>
          <td title="{{ transaction.dateAdd | time_diff }}" class="tooltips">{{ transaction.dateAdd| date('Y-m-d')}}</td>
        </tr>
      {% else %}
        <tr style="background: {{ color }}">
          <td>{{ loop.index }} <i class="fa fa-long-arrow-right"></i></td>
          <td>
            <a data-toggle="modal" class="btn blue" href="#transaction-{{ transaction.id }}"><i class='fa fa-exchange'></i> {{ transaction.code | upper  }}</a>
            {#Modal, Historique transactions.#}
            <div class="modal fade" id="transaction-{{ transaction.id }}" tabindex="-1" role="basic" aria-hidden="true">
              <div class="modal-dialog">
                <div class="modal-content">
                  <div class="modal-header">
                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true"></button>
                    <h4 class="modal-title"><i class='fa fa-exchange'></i> : {{ transaction.code | upper  }}</h4>
                  </div>
                  <div class="modal-body">
                    <div class='help-block'>
                      {% set nickname = 'Aucun' %}
                      {% if transaction.sender %}
                        {% set nickname = transaction.sender.nickname ~' | '~ transaction.sender.username %}
                      {% endif %}
                      <ul>
                        <li>{{ transaction.reason }}</li>
                        <li><i class='fa fa-user'></i> <a href='#'>{{ nickname }}</a> <i class='fa fa-long-arrow-right'></i> <a href='#'> {{ transaction.receiver.nickname ~' | '~ transaction.receiver.username }} </a></li>
                        <li><i class='fa fa-bank'></i> <a href='#'> {{ transaction.bank }} </a></li>
                        <li><i class='fa fa-money'></i> <b>Montant :</b> {{ transaction.amount.value|number_format ~' '~  transaction.amount.currency}}</li>
                        <li><i class='fa fa-money'></i> <b>Frais :</b> {{ transaction.fee|number_format ~' '~  transaction.amount.currency}}</li>
                        <li><span title='{{ transaction.dateAdd | time_diff }}' class="tooltips"><i class='fa fa-clock-o'></i> {{ transaction.dateAdd| date('Y-m-d | h:i')}}</span></li>
                        <li><label class='label' style='background: {{ color }}'>{{ transaction.state }}</label></li>
                      </ul>
                    </div>
                  </div>
                  <div class="modal-footer">
                    <button type="button" class="btn dark btn-outline" data-dismiss="modal">Fermer et Continuer</button>
                  </div>
                </div>
                <!-- /.modal-content -->
              </div>
              <!-- /.modal-dialog -->
            </div>
          </td>
          <td>{{ transaction.amount.value|number_format ~' '~  transaction.amount.currency}}</td>
          <td><a href="#">{{ transaction.bank }}</a> </td>
          <td>
            {% if transaction.course %}
              <a
                class="popovers"
                data-container="body"
                data-trigger="hover"
                data-placement="top"
                data-content="Prix : XAF {{ transaction.course.lifePrice | number_format }}"
                data-original-title="{{ transaction.course.name }}"
                href="{{ path('xs_manager_courses_show', {'id': transaction.course.id}) }}"
              >
                {{ transaction.reason }}
              </a>
              {#<a >{{ transaction.reason }}</a>#}
            {% else %}
              {{ transaction.reason }}
            {% endif %}
          </td>
          <td title="{{ transaction.dateAdd | time_diff }}" class="tooltips">{{ transaction.dateAdd| date('Y-m-d')}}</td>
        </tr>
      {% endif %}
    {% endfor %}
  {% endif %}
  </tbody>
</table>
