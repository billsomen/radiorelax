{% extends "::layout.html.twig" %}

{% block title %}
    Ajout d'images par défaut.
{% endblock %}
{% block stylesheets %}
    {{ parent() }}
    <link rel="stylesheet" href="{{ asset('css/fontawesome/font-awesome.min.css') }}">
    <link rel="stylesheet" href="{{ asset('css/bootstrap/bootstrap.min.css') }}">
    <link rel="stylesheet" href="{{ asset('cropper-master/cropper-master/assets/css/tooltip.min.css') }}">
    <link rel="stylesheet" href="{{ asset('cropper-master/cropper-master/dist/cropper.min.css') }}">
    <link rel="stylesheet" href="{{ asset('cropper-master/cropper-master/demo/css/main.css') }}">
{% endblock %}

{% block body %}
    {#todo: Exactement la meme chose que pour les messages...#}
    <div class="content-frame">
        <div class="content-frame-top">
            <div class="page-title">
                <h3>Ajout d'images par défaut.</h3>
            </div>
        </div>
        <div class="content-frame-body content-frame-body-left">
            <div class="row">
                <div class="col-md-12">
                    <!-- <h3 class="page-header">Demo:</h3> -->
                    <div class="img-container">
                        <img src="{{ asset('cropper-master/cropper-master/assets/img/picture.jpg') }}" alt="Picture">
                    </div>
                </div>
                {#<div class="col-md-3">
                    <!-- <h3 class="page-header">Preview:</h3> -->
                    <div class="docs-preview clearfix">
                        <div class="img-preview preview-lg"></div>
                        <div class="img-preview preview-md"></div>
                        <div class="img-preview preview-sm"></div>
                        <div class="img-preview preview-xs"></div>
                    </div>
                </div>#}
            </div>
            <div class="row docs-actions">
                <div class="col-md-12 docs-buttons">
                    <!-- <h3 class="page-header">Toolbar:</h3> -->
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-method="zoom" data-option="0.1" title="Zoom In">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;zoom&quot;, 0.1)">
              <span class="fa fa-search-plus"></span>
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="zoom" data-option="-0.1" title="Zoom Out">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;zoom&quot;, -0.1)">
              <span class="fa fa-search-minus"></span>
            </span>
                        </button>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-method="move" data-option="-10" data-second-option="0" title="Move Left">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;move&quot;, -10, 0)">
              <span class="fa fa-arrow-left"></span>
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="move" data-option="10" data-second-option="0" title="Move Right">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;move&quot;, 10, 0)">
              <span class="fa fa-arrow-right"></span>
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="move" data-option="0" data-second-option="-10" title="Move Up">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;move&quot;, 0, -10)">
              <span class="fa fa-arrow-up"></span>
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="move" data-option="0" data-second-option="10" title="Move Down">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;move&quot;, 0, 10)">
              <span class="fa fa-arrow-down"></span>
            </span>
                        </button>
                    </div>

                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-method="rotate" data-option="-45" title="Rotate Left">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;rotate&quot;, -45)">
              <span class="fa fa-rotate-left"></span>
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="rotate" data-option="45" title="Rotate Right">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;rotate&quot;, 45)">
              <span class="fa fa-rotate-right"></span>
            </span>
                        </button>
                    </div>
                    <div class="btn-group">
                        <button type="button" class="btn btn-primary" data-method="reset" title="Reset">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;reset&quot;)">
              <span class="fa fa-refresh"></span>
            </span>
                        </button>
                        <label class="btn btn-primary btn-upload" for="inputImage" title="Upload image file">
                            <input type="file" class="sr-only" id="inputImage" name="file" accept="image/*">
            <span class="docs-tooltip" data-toggle="tooltip" title="Import image with Blob URLs">
              <span class="fa fa-upload"></span>
            </span>
                        </label>

                    </div>

                    <div class="btn-group btn-group-justified" data-toggle="buttons">
                        <label class="btn btn-primary active" data-method="setAspectRatio" data-option="1.7777777777777777" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio1" name="aspestRatio" value="1.7777777777777777">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 16 / 9)">
              16:9
            </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="1.3333333333333333" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio2" name="aspestRatio" value="1.3333333333333333">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 4 / 3)">
              4:3
            </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="1" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio3" name="aspestRatio" value="1">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 1 / 1)">
              1:1
            </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="0.6666666666666666" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio4" name="aspestRatio" value="0.6666666666666666">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 2 / 3)">
              2:3
            </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="NaN" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio5" name="aspestRatio" value="NaN">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, NaN)">
              Free
            </span>
                        </label>
                    </div>

                    <div class="btn-group btn-group-crop">
                        <button type="button" class="btn btn-primary" data-method="getCroppedCanvas">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;getCroppedCanvas&quot;)">
              Get Cropped Canvas
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="getCroppedCanvas" data-option="{ &quot;width&quot;: 160, &quot;height&quot;: 90 }">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;getCroppedCanvas&quot;, { width: 160, height: 90 })">
              160&times;90
            </span>
                        </button>
                        <button type="button" class="btn btn-primary" data-method="getCroppedCanvas" data-option="{ &quot;width&quot;: 320, &quot;height&quot;: 180 }">
            <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;getCroppedCanvas&quot;, { width: 320, height: 180 })">
              320&times;180
            </span>
                        </button>
                    </div>

                    <!-- Show the cropped image in modal -->
                    <div class="modal fade docs-cropped" id="getCroppedCanvasModal" aria-hidden="true" aria-labelledby="getCroppedCanvasTitle" role="dialog" tabindex="-1">
                        <div class="modal-dialog">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>
                                    <h4 class="modal-title" id="getCroppedCanvasTitle">Cropped</h4>
                                </div>
                                <div class="modal-body" id="image_cropped"></div>
                                <div class="modal-footer">
                                    <button type="button" class="btn btn-default" data-dismiss="modal">Fermer</button>
                                    <a class="btn btn-primary" id="download" download="afrobusiness-{{ app.user.nickname ~'-'~ date().timestamp }}.png" >Télécharger</a>
                                    <button type="button" class="btn btn-success" id="save">Enregistrer</button>
                                </div>
                            </div>
                        </div>
                    </div><!-- /.modal -->

                </div><!-- /.docs-buttons -->

                {#<div class="col-md-3 docs-toggles">
                    <!-- <h3 class="page-header">Toggles:</h3> -->
                    <div class="btn-group btn-group-justified" data-toggle="buttons">
                        <label class="btn btn-primary active" data-method="setAspectRatio" data-option="1.7777777777777777" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio1" name="aspestRatio" value="1.7777777777777777">
                    <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 16 / 9)">
                      16:9
                    </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="1.3333333333333333" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio2" name="aspestRatio" value="1.3333333333333333">
                    <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 4 / 3)">
                      4:3
                    </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="1" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio3" name="aspestRatio" value="1">
                    <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 1 / 1)">
                      1:1
                    </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="0.6666666666666666" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio4" name="aspestRatio" value="0.6666666666666666">
                    <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, 2 / 3)">
                      2:3
                    </span>
                        </label>
                        <label class="btn btn-primary" data-method="setAspectRatio" data-option="NaN" title="Set Aspect Ratio">
                            <input type="radio" class="sr-only" id="aspestRatio5" name="aspestRatio" value="NaN">
                    <span class="docs-tooltip" data-toggle="tooltip" title="$().cropper(&quot;setAspectRatio&quot;, NaN)">
                      Free
                    </span>
                        </label>
                    </div>

                    <div class="dropdown dropup docs-options">
                        <button type="button" class="btn btn-primary btn-block dropdown-toggle" id="toggleOptions" data-toggle="dropdown" aria-expanded="true">
                            Toggle Options
                            <span class="caret"></span>
                        </button>
                        <ul class="dropdown-menu" aria-labelledby="toggleOptions" role="menu">
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="strict" checked>
                                    strict
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="responsive" checked>
                                    responsive
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="checkImageOrigin" checked>
                                    checkImageOrigin
                                </label>
                            </li>

                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="modal" checked>
                                    modal
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="guides" checked>
                                    guides
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="center" checked>
                                    center
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="highlight" checked>
                                    highlight
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="background" checked>
                                    background
                                </label>
                            </li>

                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="autoCrop" checked>
                                    autoCrop
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="dragCrop" checked>
                                    dragCrop
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="movable" checked>
                                    movable
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="rotatable" checked>
                                    rotatable
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="scalable" checked>
                                    scalable
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="zoomable" checked>
                                    zoomable
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="mouseWheelZoom" checked>
                                    mouseWheelZoom
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="touchDragZoom" checked>
                                    touchDragZoom
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="cropBoxMovable" checked>
                                    cropBoxMovable
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="cropBoxResizable" checked>
                                    cropBoxResizable
                                </label>
                            </li>
                            <li role="presentation">
                                <label class="checkbox-inline">
                                    <input type="checkbox" name="option" value="doubleClickToggle" checked>
                                    doubleClickToggle
                                </label>
                            </li>
                        </ul>
                    </div><!-- /.dropdown -->
                </div><!-- /.docs-toggles -->#}
            </div>
        </div>
        {#todo: On cree un formulaire a champ caches pour envoyer tout xa...#}
        <form id="image-send" action="{{ path('image_admin_add') }}" method="post">
            <div class="row">
                {{ form_errors(form) }}
            </div>
            {{ form_row(form._token) }}

            {{ form_widget(form.uri) }}
        </form>
        <img src="{{ src }}">
    </div>
{% endblock %}
{% block javascripts %}
    {{ parent() }}
    <script src="{{ asset('cropper-master/cropper-master/assets/js/jquery.min.js') }}"></script>
    <script src="{{ asset('cropper-master/cropper-master/assets/js/tooltip.min.js') }}"></script>
    <script src="{{ asset('cropper-master/cropper-master/assets/js/bootstrap.min.js') }}"></script>
    <script src="{{ asset('cropper-master/cropper-master/dist/cropper.js') }}"></script>
    <script src="{{ asset('cropper-master/cropper-master/demo/js/main.js') }}"></script>

    <script>

        // Upload cropped image to server
        $('#save').click(function(){
            var url = $('#download').attr('href');
            $('#form_uri').val(url);
//            todo: On envoit le formulaire
            $('#image-send').submit();
//            console.log(url);
//            var canvas = $("canvas").first();
//            var canvas = $("#image_cropped");
//            console.log(canvas);
//            var dataURL = canvas.toDataURL("image/png");
//            alert(dataURL);
        });


        $().cropper('getCroppedCanvas');

        $().cropper('getCroppedCanvas').toBlob(function (blob) {
            var formData = new FormData();
            formData.append('croppedImage', blob);


            $.ajax('{{ asset('assets/images/categories/products/computer-1.png') }}', {
                method: "POST",
                data: formData,
                processData: false,
                contentType: false,
                success: function () {
                    console.log('Upload success');
                },
                error: function () {
                    console.log('Upload error');
                }
            });
        });
    </script>
{% endblock %}


